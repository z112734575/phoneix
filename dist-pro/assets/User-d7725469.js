import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-3bb8ea92.js";import{d as a,k as t,q as l,e as r,F as o,r as s,D as i,a as n,o as d,c as u,w as m,f as p,t as c,z as f,A as v,i as _,B as h,C as g,G as y}from"./index-8191e6d7.js";import{_ as j}from"./Table.vue_vue_type_script_lang-f796c188.js";import{E as b}from"./el-button-51261f20.js";import{E as x}from"./Form-0211887f.js";import"./tsxHelper-34e7e915.js";import{E as D}from"./el-input-70775813.js";import{E as w}from"./el-divider-f3d8d03e.js";import{g as k,b as C,c as S,e as E}from"./index-9ae989e7.js";import{u as z}from"./useTable-980b041b.js";import{_ as R}from"./Search.vue_vue_type_script_setup_true_lang-595f0e6b.js";import{_ as V}from"./Write.vue_vue_type_script_setup_true_lang-cfa5d1e3.js";import{_ as I}from"./Detail.vue_vue_type_script_setup_true_lang-bd826ce4.js";import{_ as N}from"./Dialog.vue_vue_type_style_index_0_lang-a004e27d.js";import{u as P}from"./useCrudSchemas-95d8ea85.js";import"./el-card-309141ee.js";import"./el-popper-e439685c.js";import"./constants-6ec4c3fe.js";import"./el-tag-641c953b.js";import"./use-form-common-props-addbedc0.js";import"./el-image-viewer-4126c731.js";import"./debounce-1b664a76.js";import"./el-dropdown-item-a6db2ecf.js";import"./refs-0ce573a7.js";import"./use-form-item-05b2cd56.js";import"./el-col-33e389ea.js";import"./el-input-number-294918f9.js";import"./InputPassword-6db362aa.js";import"./style.css_vue_type_style_index_0_src_true_lang-277e86a4.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-a611ea54.js";import"./aria-ecee1d93.js";import"./index-055bf300.js";import"./index-6eaaf41d.js";import"./el-message-box-5154c9ce.js";import"./el-overlay-c5a4d0f9.js";import"./vnode-12283bcf.js";import"./useForm-b58ce50f.js";import"./useIcon-27659eb7.js";import"./useValidator-0437a6f9.js";import"./Descriptions-42698309.js";import"./tree-b59d36bb.js";const T={class:"flex w-100% h-100%"},U={class:"flex justify-center items-center"},A={class:"flex-1"},F={class:"mb-10px"};function L(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!g(e)}const O=a({__name:"User",setup(a){const{t:g}=t(),{tableRegister:O,tableState:W,tableMethods:q}=z({fetchDataApi:async()=>{const{pageSize:e,currentPage:a}=W,t=await C({id:n(te),pageIndex:n(a),pageSize:n(e),...n($)});return{list:t.data.list||[],total:t.data.total||0}},fetchDelApi:async()=>!!(await S(n(ce)))}),{total:G,loading:H,dataList:J,pageSize:K,currentPage:M}=W,{getList:B,getElTableExpose:Q,delList:X}=q,Y=l([{field:"selection",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{type:"selection"}},{field:"index",label:g("userDemo.index"),form:{hidden:!0},search:{hidden:!0},detail:{hidden:!0},table:{type:"index"}},{field:"username",label:g("userDemo.username")},{field:"account",label:g("userDemo.account")},{field:"department.id",label:g("userDemo.department"),detail:{slots:{default:e=>r(o,null,[e.department.departmentName])}},search:{hidden:!0},form:{component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"departmentName"}},optionApi:async()=>(await k()).data.list},table:{type:"index"}},{field:"role",label:g("userDemo.role"),search:{hidden:!0}},{field:"email",label:g("userDemo.email"),form:{component:"Input"},search:{hidden:!0}},{field:"createTime",label:g("userDemo.createTime"),form:{component:"Input"},search:{hidden:!0}},{field:"action",label:g("userDemo.action"),form:{hidden:!0},detail:{hidden:!0},search:{hidden:!0},table:{width:240,slots:{default:e=>{let a,t,l;const s=e.row;return r(o,null,[r(b,{type:"primary",onClick:()=>ve(s,"edit")},L(a=g("exampleDemo.edit"))?a:{default:()=>[a]}),r(b,{type:"success",onClick:()=>ve(s,"detail")},L(t=g("exampleDemo.detail"))?t:{default:()=>[t]}),r(b,{type:"danger",onClick:()=>fe(s)},L(l=g("exampleDemo.del"))?l:{default:()=>[l]})])}}}}]),{allSchemas:Z}=P(Y),$=s({}),ee=e=>{M.value=1,$.value=e,B()},ae=s(),te=s(""),le=s([]);(async()=>{var e,a;const t=await k();le.value=t.data.list,te.value=t.data.list[0]&&(null==(e=t.data.list[0])?void 0:e.children)&&t.data.list[0].children[0].id||"",await y(),null==(a=n(ae))||a.setCurrentKey(te.value)})();const re=s("");i((()=>re.value),(e=>{n(ae).filter(e)}));const oe=e=>{e.children||(te.value=e.id,M.value=1,B())},se=(e,a)=>!e||a.departmentName.includes(e),ie=s(!1),ne=s(""),de=s(),ue=s(""),me=()=>{ne.value=g("exampleDemo.add"),de.value=void 0,ie.value=!0,ue.value=""},pe=s(!1),ce=s([]),fe=async e=>{const a=await Q();ce.value=e?[e.id]:(null==a?void 0:a.getSelectionRows().map((e=>e.id)))||[],pe.value=!0,await X(n(ce).length).finally((()=>{pe.value=!1}))},ve=(e,a)=>{var t;ne.value=g("edit"===a?"exampleDemo.edit":"exampleDemo.detail"),ue.value=a,de.value={...e,department:(null==(t=n(ae))?void 0:t.getCurrentNode())||{}},ie.value=!0},_e=s(),he=s(!1),ge=async()=>{const e=n(_e),a=await(null==e?void 0:e.submit());if(a){he.value=!0;try{await E(a)&&(M.value=1,B())}catch(t){}finally{he.value=!1,ie.value=!1}}};return(a,t)=>(d(),u("div",T,[r(n(e),{class:"flex-1"},{default:m((()=>[p("div",U,[p("div",A,c(n(g)("userDemo.departmentList")),1),r(n(D),{modelValue:re.value,"onUpdate:modelValue":t[0]||(t[0]=e=>re.value=e),class:"flex-[2]",placeholder:n(g)("userDemo.searchDepartment"),clearable:""},null,8,["modelValue","placeholder"])]),r(n(w)),r(n(x),{ref_key:"treeEl",ref:ae,data:le.value,"default-expand-all":"","node-key":"id","current-node-key":te.value,props:{label:"departmentName"},"filter-node-method":se,onCurrentChange:oe},null,8,["data","current-node-key"])])),_:1}),r(n(e),{class:"flex-[3] ml-20px"},{default:m((()=>[r(n(R),{schema:n(Z).searchSchema,onReset:ee,onSearch:ee},null,8,["schema"]),p("div",F,[r(n(b),{type:"primary",onClick:me},{default:m((()=>[f(c(n(g)("exampleDemo.add")),1)])),_:1}),r(n(b),{loading:pe.value,type:"danger",onClick:t[1]||(t[1]=e=>fe())},{default:m((()=>[f(c(n(g)("exampleDemo.del")),1)])),_:1},8,["loading"])]),r(n(j),{"current-page":n(M),"onUpdate:currentPage":t[2]||(t[2]=e=>v(M)?M.value=e:null),"page-size":n(K),"onUpdate:pageSize":t[3]||(t[3]=e=>v(K)?K.value=e:null),columns:n(Z).tableColumns,data:n(J),loading:n(H),onRegister:n(O),pagination:{total:n(G)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])])),_:1}),r(n(N),{modelValue:ie.value,"onUpdate:modelValue":t[5]||(t[5]=e=>ie.value=e),title:ne.value},{footer:m((()=>["detail"!==ue.value?(d(),_(n(b),{key:0,type:"primary",loading:he.value,onClick:ge},{default:m((()=>[f(c(n(g)("exampleDemo.save")),1)])),_:1},8,["loading"])):h("",!0),r(n(b),{onClick:t[4]||(t[4]=e=>ie.value=!1)},{default:m((()=>[f(c(n(g)("dialogDemo.close")),1)])),_:1})])),default:m((()=>["detail"!==ue.value?(d(),_(V,{key:0,ref_key:"writeRef",ref:_e,"form-schema":n(Z).formSchema,"current-row":de.value},null,8,["form-schema","current-row"])):h("",!0),"detail"===ue.value?(d(),_(I,{key:1,"detail-schema":n(Z).detailSchema,"current-row":de.value},null,8,["detail-schema","current-row"])):h("",!0)])),_:1},8,["modelValue","title"])]))}});export{O as default};
