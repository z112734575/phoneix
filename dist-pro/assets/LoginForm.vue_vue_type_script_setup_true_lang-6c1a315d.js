import{F as e}from"./Form-0c6c296e.js";import{d as o,b as t,m as r,u as a,q as s,e as l,F as n,L as i,r as c,K as d,o as u,i as m,a as p,J as f,a2 as g,k as v}from"./index-52ef42af.js";import{E as h}from"./el-button-650eeff8.js";import{a as w}from"./tsxHelper-3957ec19.js";import{E as y}from"./el-link-edfac605.js";import{u as b}from"./useForm-95369820.js";import{l as R,g as P,a as j}from"./index-befcbcab.js";import{u as x}from"./useValidator-74be068d.js";function I(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!f(e)}const k="#999",D="var(--el-color-primary)",E=o({__name:"LoginForm",emits:["to-register"],setup(o,{emit:f}){const{required:E}=x(),F=t(),z=r(),{currentRoute:C,addRoute:q,push:A}=a(),{setStorage:S}=g(),{t:L}=v(),V={username:[E()],password:[E()]},_=s([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>l("h2",{class:"text-2xl font-bold text-center w-[100%]"},[L("login.login")])}}},{field:"username",label:L("login.username"),value:"admin",component:"Input",colProps:{span:24},componentProps:{placeholder:L("login.usernamePlaceholder")}},{field:"password",label:L("login.password"),value:"admin",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:L("login.passwordPlaceholder")}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return l(n,null,[l("div",{class:"flex justify-between items-center w-[100%]"},[l(w,{modelValue:O.value,"onUpdate:modelValue":e=>O.value=e,label:L("login.remember"),size:"small"},null),l(y,{type:"primary",underline:!1},I(e=L("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,o;return l(n,null,[l("div",{class:"w-[100%]"},[l(h,{loading:M.value,type:"primary",class:"w-[100%]",onClick:B},I(e=L("login.login"))?e:{default:()=>[e]})]),l("div",{class:"w-[100%] mt-15px"},[l(h,{class:"w-[100%]",onClick:Q},I(o=L("login.register"))?o:{default:()=>[o]})])])}}}},{field:"other",component:"Divider",label:L("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>l(n,null,[l("div",{class:"flex justify-between w-[100%]"},[l(i,{icon:"ant-design:github-filled",size:30,class:"cursor-pointer ant-icon",color:k,hoverColor:D},null),l(i,{icon:"ant-design:wechat-filled",size:30,class:"cursor-pointer ant-icon",color:k,hoverColor:D},null),l(i,{icon:"ant-design:alipay-circle-filled",size:30,color:k,hoverColor:D,class:"cursor-pointer ant-icon"},null),l(i,{icon:"ant-design:weibo-circle-filled",size:30,color:k,hoverColor:D,class:"cursor-pointer ant-icon"},null)])])}}}]),O=c(!1),{formRegister:U,formMethods:H}=b(),{getFormData:J,getElFormExpose:K}=H,M=c(!1),N=c("");d((()=>C.value),(e=>{var o;N.value=null==(o=null==e?void 0:e.query)?void 0:o.redirect}),{immediate:!0});const B=async()=>{const e=await K();await(null==e?void 0:e.validate((async e=>{if(e){M.value=!0;const e=await J();try{const o=await R(e);o&&(S(F.getUserInfo,o.data),F.getDynamicRouter?G():(await z.generateRoutes("static").catch((()=>{})),z.getAddRouters.forEach((e=>{q(e)})),z.setIsAddRouters(!0),A({path:N.value||z.addRouters[0].path})))}finally{M.value=!1}}})))},G=async()=>{const e={roleName:(await J()).username},o=F.getDynamicRouter&&F.getServerDynamicRouter?await P(e):await j(e);if(o){const e=o.data||[];S("roleRouters",e),F.getDynamicRouter&&F.getServerDynamicRouter?await z.generateRoutes("server",e).catch((()=>{})):await z.generateRoutes("frontEnd",e).catch((()=>{})),z.getAddRouters.forEach((e=>{q(e)})),z.setIsAddRouters(!0),A({path:N.value||z.addRouters[0].path})}},Q=()=>{f("to-register")};return(o,t)=>(u(),m(p(e),{schema:_,rules:V,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:p(U)},null,8,["schema","onRegister"]))}});export{E as _};
