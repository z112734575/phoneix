import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-c9faa1d2.js";import{d as a,k as t,q as l,e as r,F as o,r as i,M as s,a as n,o as d,c as m,w as u,f as p,t as c,A as f,a6 as v,i as _,U as j,H as h,a2 as g}from"./index-3fb8b7cb.js";import{_ as y}from"./Table.vue_vue_type_script_lang-54e5f184.js";import{E as x}from"./el-button-fe6fa859.js";import{E as b}from"./Form-35f5a930.js";import"./el-checkbox-b34e9317.js";import{E as D}from"./el-input-0a2e7312.js";import{E as w}from"./el-divider-65f4ecad.js";import{g as k,b as S,c as C,e as E}from"./index-15fbcdbe.js";import{u as V}from"./useTable-fbf15cf3.js";import{_ as z}from"./Search.vue_vue_type_script_setup_true_lang-edf99019.js";import{_ as R}from"./Write.vue_vue_type_script_setup_true_lang-4c8745fe.js";import{_ as T}from"./Detail.vue_vue_type_script_setup_true_lang-2c45c2a9.js";import{_ as U}from"./Dialog.vue_vue_type_style_index_0_lang-4f2615ee.js";import{u as A}from"./useCrudSchemas-5efd3451.js";import"./el-card-18a3d08b.js";import"./el-popper-ae3c2a98.js";import"./constants-dd7cca19.js";import"./el-table-column-ba4d9c74.js";import"./debounce-4edc46db.js";import"./use-form-common-props-07fdcd44.js";/* empty css               */import"./tsxHelper-58635121.js";import"./index-5e04f466.js";import"./use-form-item-9665119c.js";import"./el-image-viewer-72fb1f17.js";import"./el-dropdown-item-7f5e0c46.js";import"./castArray-6bdff974.js";import"./refs-5d4c36fc.js";/* empty css                     */import"./el-col-4d477a25.js";import"./el-radio-486b6e97.js";import"./el-input-number-2a9d2b1e.js";import"./InputPassword-33933182.js";import"./style.css_vue_type_style_index_0_src_true_lang-775fad0c.js";import"./JsonEditor.vue_vue_type_script_setup_true_lang-d2681a36.js";import"./validator-6ebf65ce.js";import"./index-2db57462.js";import"./index-5f198d6c.js";import"./index-1f155da4.js";import"./el-message-box-6cd9dd6f.js";import"./el-overlay-88072289.js";import"./vnode-aaf3d5d9.js";import"./useForm-11b0c90b.js";import"./useIcon-4a25ee4c.js";import"./useValidator-f3dd1362.js";import"./Descriptions-2b4ccfa6.js";import"./tree-b59d36bb.js";const I={class:"flex w-100% h-100%"},L={class:"flex justify-center items-center"},N={class:"flex-1"},P={class:"mb-10px"};function F(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)}const H=a({__name:"User",setup(a){const{t:h}=t(),{tableRegister:H,tableState:M,tableMethods:q}=V({fetchDataApi:async()=>{const{pageSize:e,currentPage:a}=M,t=await S({id:n(te),pageIndex:n(a),pageSize:n(e),...n(X)});return{list:t.data.list||[],total:t.data.total||0}},fetchDelApi:async()=>!!(await C(n(ce)))}),{total:K,loading:O,dataList:W,pageSize:B,currentPage:J}=M,{getList:Q,getElTableExpose:Y,delList:Z}=q,$=l([{field:"selection",search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{type:"selection"}},{field:"index",label:h("userDemo.index"),form:{hidden:!0},search:{hidden:!0},detail:{hidden:!0},table:{type:"index"}},{field:"username",label:h("userDemo.username")},{field:"account",label:h("userDemo.account")},{field:"department.id",label:h("userDemo.department"),detail:{slots:{default:e=>r(o,null,[e.department.departmentName])}},search:{hidden:!0},form:{component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"departmentName"}},optionApi:async()=>(await k()).data.list},table:{type:"index"}},{field:"role",label:h("userDemo.role"),search:{hidden:!0}},{field:"email",label:h("userDemo.email"),form:{component:"Input"},search:{hidden:!0}},{field:"createTime",label:h("userDemo.createTime"),form:{component:"Input"},search:{hidden:!0}},{field:"action",label:h("userDemo.action"),form:{hidden:!0},detail:{hidden:!0},search:{hidden:!0},table:{width:240,slots:{default:e=>{let a,t,l;const i=e.row;return r(o,null,[r(x,{type:"primary",onClick:()=>ve(i,"edit")},F(a=h("exampleDemo.edit"))?a:{default:()=>[a]}),r(x,{type:"success",onClick:()=>ve(i,"detail")},F(t=h("exampleDemo.detail"))?t:{default:()=>[t]}),r(x,{type:"danger",onClick:()=>fe(i)},F(l=h("exampleDemo.del"))?l:{default:()=>[l]})])}}}}]),{allSchemas:G}=A($),X=i({}),ee=e=>{J.value=1,X.value=e,Q()},ae=i(),te=i(""),le=i([]);(async()=>{var e,a;const t=await k();le.value=t.data.list,te.value=t.data.list[0]&&(null==(e=t.data.list[0])?void 0:e.children)&&t.data.list[0].children[0].id||"",await g(),null==(a=n(ae))||a.setCurrentKey(te.value)})();const re=i("");s((()=>re.value),(e=>{n(ae).filter(e)}));const oe=e=>{e.children||(te.value=e.id,J.value=1,Q())},ie=(e,a)=>!e||a.departmentName.includes(e),se=i(!1),ne=i(""),de=i(),me=i(""),ue=()=>{ne.value=h("exampleDemo.add"),de.value=void 0,se.value=!0,me.value=""},pe=i(!1),ce=i([]),fe=async e=>{const a=await Y();ce.value=e?[e.id]:(null==a?void 0:a.getSelectionRows().map((e=>e.id)))||[],pe.value=!0,await Z(n(ce).length).finally((()=>{pe.value=!1}))},ve=(e,a)=>{var t;ne.value=h("edit"===a?"exampleDemo.edit":"exampleDemo.detail"),me.value=a,de.value={...e,department:(null==(t=n(ae))?void 0:t.getCurrentNode())||{}},se.value=!0},_e=i(),je=i(!1),he=async()=>{const e=n(_e),a=await(null==e?void 0:e.submit());if(a){je.value=!0;try{await E(a)&&(J.value=1,Q())}catch(t){}finally{je.value=!1,se.value=!1}}};return(a,t)=>(d(),m("div",I,[r(n(e),{class:"flex-1"},{default:u((()=>[p("div",L,[p("div",N,c(n(h)("userDemo.departmentList")),1),r(n(D),{modelValue:re.value,"onUpdate:modelValue":t[0]||(t[0]=e=>re.value=e),class:"flex-[2]",placeholder:n(h)("userDemo.searchDepartment"),clearable:""},null,8,["modelValue","placeholder"])]),r(n(w)),r(n(b),{ref_key:"treeEl",ref:ae,data:le.value,"default-expand-all":"","node-key":"id","current-node-key":te.value,props:{label:"departmentName"},"filter-node-method":ie,onCurrentChange:oe},null,8,["data","current-node-key"])])),_:1}),r(n(e),{class:"flex-[3] ml-20px"},{default:u((()=>[r(n(z),{schema:n(G).searchSchema,onReset:ee,onSearch:ee},null,8,["schema"]),p("div",P,[r(n(x),{type:"primary",onClick:ue},{default:u((()=>[f(c(n(h)("exampleDemo.add")),1)])),_:1}),r(n(x),{loading:pe.value,type:"danger",onClick:t[1]||(t[1]=e=>fe())},{default:u((()=>[f(c(n(h)("exampleDemo.del")),1)])),_:1},8,["loading"])]),r(n(y),{"current-page":n(J),"onUpdate:currentPage":t[2]||(t[2]=e=>v(J)?J.value=e:null),"page-size":n(B),"onUpdate:pageSize":t[3]||(t[3]=e=>v(B)?B.value=e:null),columns:n(G).tableColumns,data:n(W),loading:n(O),onRegister:n(H),pagination:{total:n(K)}},null,8,["current-page","page-size","columns","data","loading","onRegister","pagination"])])),_:1}),r(n(U),{modelValue:se.value,"onUpdate:modelValue":t[5]||(t[5]=e=>se.value=e),title:ne.value},{footer:u((()=>["detail"!==me.value?(d(),_(n(x),{key:0,type:"primary",loading:je.value,onClick:he},{default:u((()=>[f(c(n(h)("exampleDemo.save")),1)])),_:1},8,["loading"])):j("",!0),r(n(x),{onClick:t[4]||(t[4]=e=>se.value=!1)},{default:u((()=>[f(c(n(h)("dialogDemo.close")),1)])),_:1})])),default:u((()=>["detail"!==me.value?(d(),_(R,{key:0,ref_key:"writeRef",ref:_e,"form-schema":n(G).formSchema,"current-row":de.value},null,8,["form-schema","current-row"])):j("",!0),"detail"===me.value?(d(),_(T,{key:1,"detail-schema":n(G).detailSchema,"current-row":de.value},null,8,["detail-schema","current-row"])):j("",!0)])),_:1},8,["modelValue","title"])]))}});export{H as default};
