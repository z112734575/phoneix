import{E as e,F as a}from"./Form-da70841d.js";import{u as s}from"./useForm-0f679786.js";import{u as o}from"./useValidator-38eaaa93.js";import{d as l,k as t,r,e as i,a as n,F as u,q as m,M as d,o as c,i as p,a2 as f,a8 as v}from"./index-c0be9370.js";import{a as h,E as b}from"./el-checkbox-af437bef.js";import{g as w}from"./index-78463734.js";import{e as x,f as g}from"./tree-b59d36bb.js";const j=l({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(l,{expose:j}){const k=l,{t:R}=t(),{required:y}=o(),F=r(),C=r([{field:"roleName",label:R("role.roleName"),component:"Input"},{field:"role",label:R("role.role"),component:"Input"},{field:"status",label:R("menu.status"),component:"Select",componentProps:{options:[{label:R("userDemo.disable"),value:0},{label:R("userDemo.enable"),value:1}]}},{field:"menu",label:R("role.menu"),colProps:{span:24},formItemProps:{slots:{default:()=>{var a;return i(u,null,[i("div",{class:"flex w-full"},[i("div",{class:"flex-1"},[i(e,{ref:F,"show-checkbox":!0,"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,data:K.value,"onNode-click":N},{default:e=>i("span",null,[e.data.meta.title])})]),i("div",{class:"flex-1"},[n(E)&&(null==(a=n(E))?void 0:a.permission)?i(h,{modelValue:n(E).meta.permission,"onUpdate:modelValue":e=>n(E).meta.permission=e},{default:()=>{var e;return[null==(e=n(E))?void 0:e.permission.map((e=>i(b,{label:e},null)))]}}):null])])])}}}}]),E=r(),N=e=>{E.value=e},V=m({roleName:[y()],role:[y()],status:[y()]}),{formRegister:D,formMethods:I}=s(),{setValues:P,getFormData:_,getElFormExpose:q}=I,K=r([]);(async()=>{var e;const a=await w();if(a){if(K.value=a.data.list,!k.currentRow)return;await f();const s=[];x(k.currentRow.menu,(e=>{var a;s.push({id:e.id,permission:(null==(a=e.meta)?void 0:a.permission)||[]})})),x(K.value,(e=>{const a=v(s,(a=>a.id===e.id));if(a>-1){const o={...e.meta||{}};o.permission=s[a].permission,e.meta=o}}));for(const a of s)null==(e=n(F))||e.setChecked(a.id,!0,!1)}})();return d((()=>k.currentRow),(e=>{e&&P(e)}),{deep:!0,immediate:!0}),j({submit:async()=>{var e,a;const s=await q();if(await(null==s?void 0:s.validate().catch((e=>{})))){const s=await _(),o=[...(null==(e=n(F))?void 0:e.getCheckedKeys())||[],...(null==(a=n(F))?void 0:a.getHalfCheckedKeys())||[]],l=g(n(K),(e=>o.includes(e.id)));return s.menu=l||[],s}}}),(e,s)=>(c(),p(n(a),{rules:V,onRegister:n(D),schema:C.value},null,8,["rules","onRegister","schema"]))}});export{j as _};
